{% if section.settings.enable %}
{%- assign product = all_products[section.settings.featured_product] -%}
{%- assign current_variant = product.selected_or_first_available_variant -%}

{%- if product == empty -%}
  {%- assign section_onboarding = true -%}
  {%- assign vendor = 'home_page.onboarding.product_vendor' | t -%}
  {%- assign title = 'home_page.onboarding.product_title' | t -%}
  {%- assign compare_at_price = 2999 -%}
  {%- assign price = 1999 -%}
{%- else -%}
  {%- assign section_onboarding = false -%}
  {%- assign vendor = product.vendor -%}
  {%- assign title = product.title -%}
  {%- assign compare_at_price = current_variant.compare_at_price -%}
  {%- assign price = current_variant.price -%}
{%- endif -%}

<div itemscope itemtype="http://schema.org/Product" id="FeaturedProductSection--{{ section.id }}" data-section-id="{{ section.id }}" data-section-type="product-template" data-image-zoom-type="true" data-enable-history-state="false">
  <div class="wrapper SingleProductPromo">

    <meta itemprop="url" content="{{ shop.url }}{{ product.url }}">
    <meta itemprop="image" content="{{ product.featured_image.src | img_url: 'grande' }}">

    <div class="grid product-single">
      <div class="grid__item large--seven-twelfths medium--seven-twelfths text-center">
        <div class="product-single__photos product-single__photosMain">
          {% assign featured_image = product.featured_image | default: product.featured_image %}
          <div id="{{ img_wrapper_id }}" class="featured_image" data-image-id="{{ image.id }}">
            <div>
              <img class="lazyload lazypreload {{ img_id_class }}"
                   src="{{ featured_image | img_url: 'master' }}"
                   alt="{{ image.alt | escape }}">
            </div>
          </div>
        </div>
      </div>

      <div class="grid__item product-single__meta--wrapper medium--five-twelfths large--five-twelfths{% if section.settings.product_selector == 'radio' %} funnel__1{% endif %}">
        {% if section.settings.show_vendor %}
          <h2 class="product-single__vendor" itemprop="brand">{{ vendor }}</h2>
        {% endif %}

        <h1 class="product-single__title" itemprop="name">{{ title }}</h1>

        <div itemprop="offers" itemscope itemtype="http://schema.org/Offer">
          <div data-price-container>
            {% comment %}
              Optionally show the 'compare at' or original price of the product.
            {% endcomment %}
            {% if compare_at_price > price %}
              <span id="PriceA11y" class="visually-hidden" {% unless current_variant.available %}aria-hidden="true"{% endunless %}>{{ 'products.general.regular_price' | t }}</span>
              <span class="product-single__price--wrapper" aria-hidden="false">
                <span id="ComparePrice" class="product-single__price--compare-at">
                  {{ compare_at_price | money }}
                </span>
              </span>
              <span id="ComparePriceA11y" class="visually-hidden" aria-hidden="false">{{ 'products.general.sale_price' | t }}</span>
            {% else %}
              <span id="PriceA11y" class="visually-hidden" {% unless current_variant.available %}aria-hidden="true"{% endunless %}>{{ 'products.general.regular_price' | t }}</span>
              <span class="product-single__price--wrapper hide" aria-hidden="true">
                <span id="ComparePrice" class="product-single__price--compare-at"></span>
              </span>
              <span id="ComparePriceA11y" class="visually-hidden" aria-hidden="true">{{ 'products.general.sale_price' | t }}</span>
            {% endif %}

            <span id="ProductPrice"
              class="product-single__price{% if compare_at_price > price %} on-sale{% endif %}"
              itemprop="price"
              content="{{ price | divided_by: 100.00 }}"
              {% unless current_variant.available %}aria-hidden="true"{% endunless %}>
              {{ price | money }}
            </span>
            {% if section.settings.get_freeshipping != blank %}
            	
            {% if section.settings.get_freeshipping_text != blank %}
            	<span class="free-shipping-text">{{ section.settings.get_freeshipping_text }}</span>
            {% endif %}
              {% comment %}
              {% if product.price != 0 %} 
              <span class="free-shipping-text">+ FREE Shipping</span>
              {% else %}
              <span class="free-shipping-text">+ Shipping</span>
              {% endif %}
              {% endcomment %}
            {% endif %}
            
                 {% capture discount_percentage %}
{{ product.compare_at_price_max | minus:product.price | times:100 | divided_by:product.compare_at_price_max }}%
                {% endcapture %}
                {% capture discount_dollar %}
{{ product.compare_at_price_max | minus:product.price | money }}
                {% endcapture %}
              
              {% if product.compare_at_price_max > product.price %}            
<div class="you-save">You save {{ discount_dollar }} {% unless product.id == 11 %}(–{{discount_percentage}}) {% endunless %}</div>
            {% endif %} 
          </div>



          <hr class="hr--small">
          {% if section.settings.show_product_description != blank %}
            <div class="product-single__description rte" itemprop="description">
              {{ product.description }}
            </div>
          {% endif %}
          <meta itemprop="priceCurrency" content="{{ shop.currency }}">
          <link itemprop="availability" href="http://schema.org/{% if product.available %}InStock{% else %}OutOfStock{% endif %}">

          {% if section_onboarding %}
            <div class="product-single__add-to-cart default-product">
              <button type="submit" name="add" id="AddToCart--{{ section.id }}" class="btn btn--add-to-cart" disabled="disabled">
                <span class="btn__text">
                  {{ 'products.product.sold_out' | t }}
                </span>
              </button>
            </div>
          {% else %}
            {% capture "form_classes" %}
              product-single__form{% if product.has_only_default_variant %} product-single__form--no-variants{% endif %}
            {%- endcapture %}

            {% capture "form_id" %}AddToCartForm--{{ section.id }}{%- endcapture %}
			{% include 'promo' %}
            {% form 'product', product, class:form_classes, id:form_id %}
          

          {% comment %}
          {% if product.variants.size > 1 %}
          <div class="product-form mfp-link">
            <select name="id" id="ProductSelect" class="product-form__variants selectbox no-js">
              {% for variant in product.variants %}
              {% if variant.available %}
              <option{% if variant == current_variant %} selected="selected"{% endif %} value="{{ variant.id }}">{{ variant.title }}</option>
              {% else %}
              <option disabled="disabled">{{ variant.title }} - {{ 'products.product.sold_out' | t }}</option>
              {% endif %}
              {% endfor %}
            </select>
          </div>
          {% endif %}
          {% endcomment %}

          {% unless product.has_only_default_variant %}
          {% for option in product.options_with_values %}
          <div class="radio-wrapper js product-form__item">
            <label class="single-option-radio__label{% if option.name == 'Default' or option.name == 'Title' %} hidden-label{% endif %}"
                   for="ProductSelect-option-{{ forloop.index0 }}">
              {{ option.name | escape }}
            </label>
            {% if section.settings.product_selector == 'radio' %}
            <fieldset class="single-option-radio"
                      name="{{ option.name | handleize }}"
                      id="ProductSelect-option-{{ forloop.index0 }}">
              {% assign option_index = forloop.index %}
              {% for value in option.values %}
              {% assign variant_label_state = true %}
              {% if product.options.size == 1 %}
              {% unless product.variants[forloop.index0].available  %}
              {% assign variant_label_state = false %}
              {% endunless %}
              {% endif %}
              <input type="radio"
                     {% if option.selected_value == value %} checked="checked"{% endif %}
                     {% unless variant_label_state %} disabled="disabled"{% endunless %}
                     value="{{ value | escape }}"
                     data-index="option{{ option_index }}"
                     name="{{ option.name | handleize }}"
                     class="single-option-selector__radio{% unless variant_label_state %} disabled{% endunless %}"
                     id="ProductSelect-option-{{ option.name | handleize }}-{{ value | escape }}">
              <label for="ProductSelect-option-{{ option.name | handleize }}-{{ value | escape }}"{% unless variant_label_state %} class="disabled"{% endunless %}>{{ value | escape }}</label>
              {% endfor %}
            </fieldset>
            {% endif %}
          </div>
          {% endfor %}
          {% endunless %}

          <div class="product-form mfp-link">
            <select name="id" id="ProductSelect" class="product-single__variants no-js">
              {% for variant in product.variants %}
              {% if variant.available %}
              <option {% if variant == product.selected_or_first_available_variant %}
                      selected="selected" {% endif %}
                      data-sku="{{ variant.sku }}"
                      value="{{ variant.id }}">
                {{ variant.title }} - {{ variant.price | money_with_currency }}
              </option>
              {% else %}
              <option disabled="disabled">
                {{ variant.title }} - {{ 'products.product.sold_out' | t }}
              </option>
              {% endif %}
              {% endfor %}
            </select>
          </div>


              <div class="product-single__add-to-cart product-single__add-to-cart--full-width">
                <button type="submit" name="add" id="AddToCart--{{ section.id }}" class="btn btn--add-to-cart{% if section.settings.enable_payment_button %} btn--secondary-accent{% endif %}"{% unless current_variant.available %} disabled="disabled"{% endunless %}>
                  <span class="btn__text">
                    {% if current_variant.available %}
                      {{ 'products.product.add_to_cart' | t }}
                    {% else %}
                      {{ 'products.product.sold_out' | t }}
                    {% endif %}
                  </span>
                </button>
                {% if section.settings.enable_payment_button %}
                  {{ form | payment_button }}
                {% endif %}
          </div>
          {% endform %}
          {% endif %}
        </div>
        
        <div class="stockAlert"></div>
        
        
        <div class="product-single__features">
          <div class="table-wrapper">
            <div class="table-wrapper">
              <table>
                <tbody>
                  <tr class="product-single__feature">
                    <th>Shipping</th>
                    <td class="product-shipping__feature">{% if product.price != 0 %}Ships within 24 hours{% else %} Worldwide Insured Shipping {% endif %} <img src="//cdn.shopify.com/s/files/1/2560/1012/files/globe-33.png?2861726417733511199" style="max-width:20px" /></td>
                  </tr>
                  <tr class="product-single__feature">
                    <th>Secure Payment</th>
                    <td><img src="//cdn.shopify.com/s/files/1/2560/1012/files/paymentmethod-v2.png?1479307129020704333" class="desk-payment">
                      <img src="//cdn.shopify.com/s/files/1/2560/1012/files/paymentmethod-mobile-v2.png?1479307129020704333" class="mobile-payment">
                    </td>
                  </tr>
                  <tr class="product-single__feature product-single__feature--with-image">
                    <th>Guarantee</th>
                    {% if product.type == 'Design Your Own' %}
                    <td><img src="//cdn.shopify.com/s/files/1/2560/1012/files/product_guarantee.png?7516454658225735423">We offer a 2-year limited warranty. We don't accept returns on Design Your Own products.</td>
                    {% else %}
                    <td><img src="//cdn.shopify.com/s/files/1/2560/1012/files/product_guarantee.png?7516454658225735423">We offer a 1-year limited warranty and a 30-day money-back guarantee.</td>
                    {% endif %}
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
        {% comment %}
        <div class="product-single__features">
          <div class="table-wrapper">
            <div class="table-wrapper">
              <table>
                <tbody>
                  <tr class="product-single__feature">
                    {% if section.settings.main_title != blank %}
                    <th>{{ section.settings.main_title }}</th>
                    {% endif %}
                    {% if section.settings.main_desc != blank %}
                    <td class="product-shipping__feature">{{ section.settings.main_desc }}</td>
                    {% endif %}
                  </tr>
                  {% for block in section.blocks %}
                    {% if block.type == 'only_image' %}
                      <tr class="product-single__feature">
                        {% if block.settings.sub_title1 != blank %}
                        <th>{{ block.settings.sub_title1 }}</th>
                        {% endif %}

                        {% if block.settings.sub_desc1 != blank %}
                        <td>{{ block.settings.sub_desc1 }}</td>
                        {% endif %}
                      </tr>
                  	{% elsif block.type == 'first_image' %}
                      <tr class="product-single__feature product-single__feature--with-image">
                        {% if block.settings.sub_title2 != blank %}
                        <th>{{ block.settings.sub_title2 }}</th>
                        {% endif %}
                        {% if block.settings.sub_desc2 != blank %}                        
                          <td>{{ block.settings.sub_desc2 }}</td>
                        {% endif %}
                      </tr>
                    {% endif %}
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        </div>
        {% endcomment %}
        <a class="product-single__full-details text-link"{% unless section_onboarding %} href="{{ product.url }}?variant={{ current_variant.id }}"{% endunless %}>
          {{ 'products.product.full_details' | t }} <span class="icon icon-arrow-right" aria-hidden="true"></span>
        </a>

        {% if section.settings.show_share_buttons %}
          {% include 'social-sharing', share_title: product.title, share_permalink: product.url, share_image: product %}
        {% endif %}
      </div>
    </div>

    {% if collection %}
      <hr class="hr--clear">
      <div class="text-center">
        <a href="{{ collection.url }}" class="return-link">&larr; {{ 'products.general.collection_return' | t: collection: collection.title }}</a>
      </div>
    {% endif %}
  </div>
</div>
{% include 'judgeme_widgets', widget_type: 'judgeme_review_widget', concierge_install: false %}
{% endif %}
{% unless product.empty == empty %}
  <script type="application/json" id="ProductJson-{{ section.id }}">
    {{ product | json }}
  </script>
{% endunless %}

  <script>
$(document).ready(function(){
var rn = Math.floor(Math.random() * 6) + 6;

if($.cookie('stockNo')) {
rn = $.cookie('stockNo');
} else {
$.cookie('stockNo', rn, { expires: 1 });
}
  $('.stockAlert').html('<i>Only <strong>'+rn+'</strong> left in stock!</i>');
});
</script>

<script>
  var selectCallbackMain = function(variant, selector) {
    var form = jQuery('#' + selector.domIdPrefix).closest('form');


    var mf = "{{ shop.money_format }}";

    if (variant && variant.available) {
      jQuery('#AddToCart').removeAttr('disabled').removeClass('disabled').find('span').text('ADD TO CART'); 
      jQuery('.stockStatus').html('InStock');
      if(variant.price < variant.compare_at_price){
        jQuery('#ProductPrice').html(Shopify.formatMoney(variant.price, mf));
        $('#ComparePrice').html(Shopify.formatMoney(variant.compare_at_price, mf));
      } else {
        jQuery('#ProductPrice').html(Shopify.formatMoney(variant.price, mf));
      }
    } else {
      jQuery('#AddToCart').addClass('disabled').attr('disabled', 'disabled').find('span').text('Sold out'); 
      var message = variant ? 'Sold out' : 'Unavailable';
      jQuery('.stockStatus').html(message);
    }


    if(variant && variant.featured_image) {
      var pts = Shopify.resizeImage(variant.featured_image.src,'1024x1024');
      setTimeout(function(){
        $('.SingleProductPromo .featured_image img').attr("src",pts);
        $('.SingleProductPromo .featured_image img').css('background', 'red');
      },500);
    }
  }

  // initialize multi selector for product
  jQuery(function($) {
    new Shopify.OptionSelectors("ProductSelect", { product:  {{ product | json }} , onVariantSelected: selectCallbackMain });
  });
</script>


{% if section.settings.product_selector == 'radio' %}
<style>
  .template-page .funnel__1 .selector-wrapper{
    display:none;
  }
</style>
{% endif %}
{% schema %}
{
  "name": {
    "de": "Vorgestelltes Produkt",
    "en": "Featured product",
    "es": "Producto destacado",
    "fr": "Produit en vedette",
    "it": "Prodotto in primo piano",
    "ja": "おすすめ商品",
    "pt-BR": "Produto em destaque"
  },
  "settings": [
{
		"type": "checkbox",
		"id": "enable",
		"label": "Section Enable",
		"default": true
	},
    {
      "type": "product",
      "id": "featured_product",
      "label": {
        "de": "Produkt",
        "en": "Product",
        "es": "Producto",
        "fr": "Produit",
        "it": "Prodotto",
        "ja": "商品",
        "pt-BR": "Produto"
      }
    },
    {
      "type": "checkbox",
      "id": "show_variant_labels",
      "label": {
        "de": "Variantenbezeichnungen anzeigen",
        "en": "Show variant labels",
        "es": "Mostrar etiquetas variantes",
        "fr": "Afficher les étiquettes de variantes",
        "it": "Mostra etichette varianti",
        "ja": "バリエーションのラベルを表示する",
        "pt-BR": "Exibir etiquetas variantes"
      },
      "default": true
    },
    {
      "type": "select",
      "id": "product_selector",
      "label": {
        "de": "Auswahlart",
        "en": "Picker type",
        "es": "Tipo de selector",
        "fr": "Type de sélecteur",
        "it": "Tipo di selettore",
        "ja": "ピッカーの種類",
        "pt-BR": "Tipo de seletor"
      },
      "options": [
        {
          "value": "radio",
          "label": {
            "de": "Schaltfläche",
            "en": "Button",
            "es": "Botón",
            "fr": "Bouton",
            "it": "Pulsante",
            "ja": "ボタン",
            "pt-BR": "Botão"
          }
        },
        {
          "value": "select",
          "label": {
            "de": "Dropdown",
            "en": "Dropdown",
            "es": "Desplegable",
            "fr": "Menu déroulant",
            "it": "Menu a tendina",
            "ja": "ドロップダウン",
            "pt-BR": "Menu suspenso"
          }
        }
      ]
    },
    {
      "type": "checkbox",
      "id": "show_vendor",
      "label": {
        "de": "Anbieter anzeigen",
        "en": "Show vendor",
        "es": "Mostrar proveedor",
        "fr": "Afficher le distributeur",
        "it": "Mostra fornitore",
        "ja": "販売元を表示する",
        "pt-BR": "Exibir fornecedor"
      },
      "default": false
    },
    {
      "type": "checkbox",
      "id": "enable_payment_button",
      "label": {
        "de": "Dynamischen Checkout-Button anzeigen",
        "en": "Show dynamic checkout button",
        "es": "Mostrar botón de pago dinámico",
        "fr": "Afficher le bouton de passage à la caisse dynamique",
        "it": "Mostra pulsante di check-out dinamico",
        "ja": "ダイナミックチェックアウトボタンを表示する",
        "pt-BR": "Exibir botão dinâmico de finalização da compra"
      },
      "info": {
        "de": "Geben Sie Kunden die Möglichkeit, direkt mit einer vertrauten Zahlungsmethode auszuchecken. [Mehr Infos](https://help.shopify.com/manual/using-themes/change-the-layout/dynamic-checkout)",
        "en": "Lets customers check out directly using a familiar payment method. [Learn more](https://help.shopify.com/manual/using-themes/change-the-layout/dynamic-checkout)",
        "es": "Permite a los clientes pagar directamente usando un método de pago familiar. [Más información](https://help.shopify.com/manual/using-themes/themes-by-shopify/brooklyn#navigation-tips-tips-specific)",
        "fr": "Permet aux clients de passer directement à la caisse en utilisant un moyen de paiement familier. [En savoir plus](https://help.shopify.com/manual/using-themes/change-the-layout/dynamic-checkout)",
        "it": "Fai in modo che i clienti effettuino il check-out direttamente utilizzando un metodo di pagamento a loro conosciuto. [Maggiori informazioni](https://help.shopify.com/manual/using-themes/change-the-layout/dynamic-checkout)",
        "ja": "使い慣れた決済方法を使用して、お客様に直接チェックアウトしてもらいましょう。[もっと詳しく](https://help.shopify.com/manual/using-themes/change-the-layout/dynamic-checkout)",
        "pt-BR": "Permite que os clientes finalizem os pedidos na hora usando um método de pagamento salvo. [Saiba mais](https://help.shopify.com/manual/using-themes/change-the-layout/dynamic-checkout)"
      },
      "default": false
    },
    {
      "type": "checkbox",
      "id": "show_share_buttons",
      "label": {
        "de": "Social-Sharing-Schaltflächen anzeigen",
        "en": "Show social sharing buttons",
        "es": "Mostrar botones para compartir en redes sociales",
        "fr": "Afficher les boutons de partage social",
        "it": "Mostra i pulsanti per la condivisione sui social",
        "ja": "ソーシャル共有ボタンを表示する",
        "pt-BR": "Exibir botões de compartilhamento em redes sociais"
      },
      "default": true,
      "info": {
        "de": "Bearbeiten Sie Social-Media-Konten in den allgemeinen Einstellungen",
        "en": "Edit social accounts in General settings",
        "es": "Editar cuentas sociales en la configuración general",
        "fr": "Modifier les comptes sociaux dans les paramètres généraux",
        "it": "Modifica gli account social nelle Impostazioni generali",
        "ja": "一般設定でソーシャルアカウントを編集する",
        "pt-BR": "Edite as contas de redes sociais nas configurações gerais"
      }
    },
	{
		"content":"FreeShipping text",
		"type":"header"
	},
	{
		"type":"checkbox",
		"id":"get_freeshipping",
		"label":"Show FreeShipping"
	},
	{
		"type":"text",
		"id":"get_freeshipping_text",
		"label":"FreeShipping Text"
	},
	{
		"content":"Product Description",
		"type":"header"
	},
	{
		"type":"checkbox",
		"id":"show_product_description",
		"label":"Show Description"
	}
  ]
}
{% endschema %}

